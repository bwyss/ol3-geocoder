/**
 * A geocoder extension for OpenLayers 3.
 * https://github.com/jonataswalker/ol3-geocoder
 * Version: v2.3.0
 * Built: 2016-08-15T11:57:59-03:00
 */

!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Geocoder=b()}(this,function(){"use strict";var a="ol3-geocoder",b="-container",c="-search",d="-btn-search",e="-loading",f="-result",g="-search-expanded",h="-country",i="-city",j="-road",k="ol-control",l="form-geocoder",m="-input-search",n="gcd-input",o={ADDRESSCHOSEN:"addresschosen"},p=[new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:["data:image/png;base64,","iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAABmJLR0QA/wD/AP+gvaeT","AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AQWCiErd9Z21AAABAJJREFUWMPVm","U1oXFUUx3/3zatJx04SDOgiVUMSgrXJwpqIKy26SrKoLjQgCkIFW7otuCvdllbo1q6Epg","vNQvtx710lEFdihwpSjdikJLGJWEhrM9MyX7nPxbypwzBv5n3cqXpgmOHOuff/mzPn3Pf","ueWDBpqZnrPq1M5EUVitZ+9wPvA0cAgaALqAIbAI3gAWt5HbjvCcGXROdmp4RwDDwBfBW","iKmLwKfAqlbSiwvvJAAeAeaBWyGB8f1uAfNT0zMj/jqdjXQd8Ds+sJsguyrAe1rJb6NGX","MQAPgJ8k7QefPOAd7WSl6OAi4jAk8D3cdKqhRngda3k9bDgUSL9NLAO9GPftoEXtZIPrR","WiXyzHwwAbA8WyoFAUFMsCY0JB9wPHwxalGyH3T4RxHByo8MZEgf4+w/ZfDt9lu9n4I5T","MCeBzP8+tQL8KDAZuA7swOljh4yM5JsaKGAPGA0fABzN5sje7+PJyht/WXNxU8O/1dbK2","9ulPWn05tL/CqWP3GR8tUSgKSmVBpVJ9LxQF46MlTh27z9D+SiKdqNCBFw/jwexUnr4eg","xfwx3oe9PUYZqfyGC+eThzo4SCYTNpweLLQtuCMgcOTBTLp4B8XpBMXuqnfroGxkTIi5M","YpRNV/1yTjCQv9oHmkBXu7vRD1/s/1b2+3h+eJSDpxoa83G0w5HisbLqRCrpKClQ2XlON","F0okL/XXTyQ6sbe1h/Y7bNkWEgPU7Lmtbe3CcaDpxoS8CuaYbfcpj7mqmVXE9Ltq5qxnc","VKBjztexBl0Azgd9uZTt4spimlJZkHKqUa29Ug6UyoIri2mWsl2tNM77OlZvmIaBn4B00","6tiRfDSUIk3JwocerlIzz7DTt7hxi9dLGW7+fX2U7huYJQfAeNayduduDX9Cni/3X5sPI","HnVSPtCK9VDj/OZa3krPVbUx++J+y2FNF6tZI71s+IfhR2gNOWgU9rJXeinBUjnxGBF4A","fgWcsAN8DXgE2OnJGbIC/CHxoAXpOK/lRx1sIvn1mKTVirRO377EFnE0IfFYrudXxvkdD","bvcCvwOZGEvkgOeBB0+kwwTU9tIccClmlC8Bubj9vKQNyAPAzxHX8YCDWsnluLpOAmB84","fmIU+e1kstJ2r42OkVH/S5R2G7S0aSCsaFrHU+tZB44F3LaOa1k/l/pTzfZSQ4APwD7Wr","jmgdeA5STAttKjltsLbdwWkhSf1UjXRfxZ4M8WLs9pJe/a0HIsAeMDnQlwOaOVvPufeFD","UJLcH/H27t6EtcBDYTJrLViNdl9ubwLWG4Wv+uDUTWDb/LLlSNzSilVy1qeFYBsYHvOAP","XdBKrtrK5Y5A19lJqo8kTnZi8U6kRy0YY8BNwNgqwP+1/Q09w5giQWRk7AAAAABJRU5Er","kJggg=="].join("")})})],q={OSM:"osm",MAPQUEST:"mapquest",GOOGLE:"google",PHOTON:"photon",BING:"bing",PELIAS:"pelias"},r={provider:q.OSM,placeholder:"Search for an address",featureStyle:p,lang:"en-US",limit:5,keepOpen:!1,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:2,debug:!1},s={toQueryString:function(a){var b=this;return Object.keys(a).reduce(function(c,d){return c.push("object"==typeof a[d]?b.toQueryString(a[d]):encodeURIComponent(d)+"="+encodeURIComponent(a[d])),c},[]).join("&")},encodeUrlXhr:function(a,b){if(b&&"object"==typeof b){var c=this.toQueryString(b);a+=(/\?/.test(a)?"&":"?")+c}return a},json:function(a,b){var c=new XMLHttpRequest,d="",e="",f={},g=function(){200===c.status&&f.ready.call(void 0,JSON.parse(c.response))},h=function(){console.info("Cannot XHR "+JSON.stringify(a))};return"object"==typeof a?(d=a.url,b=a.data,e=a.data_type||"json"):d=a,d=this.encodeUrlXhr(d,b),"jsonp"===e?this.jsonp(d,a.callbackName,function(a){f.ready.call(void 0,a)}):(c.open("GET",d,!0),c.setRequestHeader("Accept","application/json"),c.onload=g,c.onerror=h,c.send(null)),{when:function(a){f.ready=a.ready}}},jsonp:function(a,b,c){var d=document.head,e=document.createElement("script"),f="f"+Math.round(Math.random()*Date.now());e.setAttribute("src",a+(a.indexOf("?")>0?"&":"?")+b+"="+f),window[f]=function(a){window[f]=void 0,setTimeout(function(){d.removeChild(e)},0),c(a)},d.appendChild(e)},now:function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}return window.performance.now()},flyTo:function(a,b,c,d){d=d||2.388657133911758,c=c||500;var e=a.getView(),f=ol.animation.pan({duration:c,source:e.getCenter()}),g=ol.animation.zoom({duration:c,resolution:e.getResolution()});a.beforeRender(f,g),e.setCenter(b),e.setResolution(d)},randomId:function(a){var b=this.now().toString(36);return a?a+b:b},isNumeric:function(a){return/^\d+$/.test(a)},classRegex:function(a){return new RegExp("(^|\\s+) "+a+" (\\s+|$)")},addClass:function(a,b,c){var d=this;if(Array.isArray(a))return void a.forEach(function(a){d.addClass(a,b)});for(var e=Array.isArray(b)?b:b.split(/\s+/),f=e.length;f--;)d.hasClass(a,e[f])||d._addClass(a,e[f],c)},_addClass:function(a,b,c){var d=this;a.classList?a.classList.add(b):a.className=(a.className+" "+b).trim(),c&&this.isNumeric(c)&&window.setTimeout(function(){d._removeClass(a,b)},c)},removeClass:function(a,b,c){var d=this;if(Array.isArray(a))return void a.forEach(function(a){d.removeClass(a,b,c)});for(var e=Array.isArray(b)?b:b.split(/\s+/),f=e.length;f--;)d.hasClass(a,e[f])&&d._removeClass(a,e[f],c)},_removeClass:function(a,b,c){var d=this;a.classList?a.classList.remove(b):a.className=a.className.replace(this.classRegex(b)," ").trim(),c&&this.isNumeric(c)&&window.setTimeout(function(){d._addClass(a,b)},c)},hasClass:function(a,b){return a.classList?a.classList.contains(b):this.classRegex(b).test(a.className)},toggleClass:function(a,b){var c=this;return Array.isArray(a)?void a.forEach(function(a){c.toggleClass(a,b)}):void(a.classList?a.classList.toggle(b):this.hasClass(a,b)?this._removeClass(a,b):this._addClass(a,b))},$:function(a){return a="#"===a[0]?a.substr(1,a.length):a,document.getElementById(a)},isElement:function(a){return"HTMLElement"in window?!!a&&a instanceof HTMLElement:!!a&&"object"==typeof a&&1===a.nodeType&&!!a.nodeName},getAllChildren:function(a,b){return[].slice.call(a.getElementsByTagName(b))},isEmpty:function(a){return!a||0===a.length},emptyArray:function(a){for(;a.length;)a.pop()},anyMatchInArray:function(a,b){return a.some(function(a){return b.indexOf(a)>=0})},everyMatchInArray:function(a,b){return b.every(function(b){return a.indexOf(b)>=0})},anyItemHasValue:function(a,b){var c=this;void 0===b&&(b=!1);for(var d in a)c.isEmpty(a[d])||(b=!0);return b},removeAllChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},removeAll:function(a){for(var b;b=a[0];)b.parentNode.removeChild(b)},getChildren:function(a,b){return[].filter.call(a.childNodes,function(a){return b?1==a.nodeType&&a.tagName.toLowerCase()==b:1==a.nodeType})},template:function(a,b){var c=this;return a.replace(/\{ *([\w_-]+) *\}/g,function(a,d){var e=void 0===b[d]?"":b[d];return c.htmlEscape(e)})},htmlEscape:function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},mergeOptions:function(a,b){var c={};for(var d in a)c[d]=a[d];for(var e in b)c[e]=b[e];return c},createElement:function(a,b){var c;if(Array.isArray(a)){if(c=document.createElement(a[0]),a[1].id&&(c.id=a[1].id),a[1].classname&&(c.className=a[1].classname),a[1].attr){var d=a[1].attr;if(Array.isArray(d))for(var e=-1;++e<d.length;)c.setAttribute(d[e].name,d[e].value);else c.setAttribute(d.name,d.value)}}else c=document.createElement(a);c.innerHTML=b;for(var f=document.createDocumentFragment();c.childNodes[0];)f.appendChild(c.childNodes[0]);return c.appendChild(f),c},assert:function(a,b){if(void 0===b&&(b="Assertion failed"),!a){if("undefined"!=typeof Error)throw new Error(b);throw b}}},t=function(){this.settings={url:"//photon.komoot.de/api/",params:{q:"",limit:10,lang:"en"},langs:["de","it","fr","en"]}};t.prototype.getParameters=function(a){return a.lang=a.lang.toLowerCase(),{url:this.settings.url,params:{q:a.query,limit:a.limit||this.settings.params.limit,lang:this.settings.langs.indexOf(a.lang)>-1?a.lang:this.settings.params.lang}}},t.prototype.handleResponse=function(a){return a.map(function(a){return{lon:a.geometry.coordinates[0],lat:a.geometry.coordinates[1],address:{name:a.properties.name,postcode:a.properties.postcode,city:a.properties.city,state:a.properties.state,country:a.properties.country},original:{formatted:a.properties.name,details:a.properties}}})};var u=function(){this.settings={url:"//nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}};u.prototype.getParameters=function(a){return{url:this.settings.url,params:{q:a.query,format:"json",addressdetails:1,limit:a.limit||this.settings.params.limit,countrycodes:a.countrycodes||this.settings.params.countrycodes,"accept-language":a.lang||this.settings.params["accept-language"]}}},u.prototype.handleResponse=function(a){return a.map(function(a){return{lon:a.lon,lat:a.lat,address:{name:a.address.neighbourhood||"",road:a.address.road||"",postcode:a.address.postcode,city:a.address.city||a.address.town,state:a.address.state,country:a.address.country},original:{formatted:a.display_name,details:a.address}}})};var v=function(){this.settings={url:"//open.mapquestapi.com/nominatim/v1/search.php",params:{q:"",key:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}};v.prototype.getParameters=function(a){return{url:this.settings.url,params:{q:a.query,key:a.key,format:"json",addressdetails:1,limit:a.limit||this.settings.params.limit,countrycodes:a.countrycodes||this.settings.params.countrycodes,"accept-language":a.lang||this.settings.params["accept-language"]}}},v.prototype.handleResponse=function(a){return a.map(function(a){return{lon:a.lon,lat:a.lat,address:{name:a.address.neighbourhood||"",road:a.address.road||"",postcode:a.address.postcode,city:a.address.city||a.address.town,state:a.address.state,country:a.address.country},original:{formatted:a.display_name,details:a.address}}})};var w=function(){this.settings={url:"//search.mapzen.com/v1/search",params:{text:"",key:"",size:10}}};w.prototype.getParameters=function(a){return{url:this.settings.url,params:{text:a.query,key:a.key,size:a.limit||this.settings.params.size}}},w.prototype.handleResponse=function(a){return a.map(function(a){return{lon:a.geometry.coordinates[0],lat:a.geometry.coordinates[1],address:{name:a.properties.name,house_number:a.properties.housenumber,postcode:a.properties.postalcode,road:a.properties.street,city:a.properties.city,state:a.properties.region,country:a.properties.country},original:{formatted:a.properties.label,details:a.properties}}})};var x=function(){this.settings={url:"//maps.googleapis.com/maps/api/geocode/json",params:{address:"",key:"",language:"en-US"}}};x.prototype.getParameters=function(a){return{url:this.settings.url,params:{address:a.query,key:a.key,language:a.lang||this.settings.params.language}}},x.prototype.handleResponse=function(a){var b=["point_of_interest","establishment","natural_feature","airport"],c=["street_address","route","sublocality_level_5","intersection"],d=["postal_code"],e=["locality"],f=["administrative_area_level_1"],g=["country"],h=function(a){var h={name:"",road:"",postcode:"",city:"",state:"",country:""};return a.forEach(function(a){s.anyMatchInArray(a.types,b)?h.name=a.long_name:s.anyMatchInArray(a.types,c)?h.road=a.long_name:s.anyMatchInArray(a.types,d)?h.postcode=a.long_name:s.anyMatchInArray(a.types,e)?h.city=a.long_name:s.anyMatchInArray(a.types,f)?h.state=a.long_name:s.anyMatchInArray(a.types,g)&&(h.country=a.long_name)}),h},i=[];return a.forEach(function(a){var b=h(a.address_components);s.anyItemHasValue(b)&&i.push({lon:a.geometry.location.lng,lat:a.geometry.location.lat,address:{name:b.name,postcode:b.postcode,road:b.road,city:b.city,state:b.state,country:b.country},original:{formatted:a.formatted_address,details:a.address_components}})}),i};var y=function(){this.settings={url:"//dev.virtualearth.net/REST/v1/Locations",callbackName:"jsonp",params:{query:"",key:"",includeNeighborhood:0,maxResults:10}}};y.prototype.getParameters=function(a){return{url:this.settings.url,callbackName:this.settings.callbackName,params:{query:a.query,key:a.key,includeNeighborhood:a.includeNeighborhood||this.settings.params.includeNeighborhood,maxResults:a.maxResults||this.settings.params.maxResults}}},y.prototype.handleResponse=function(a){return a.map(function(a){return{lon:a.point.coordinates[1],lat:a.point.coordinates[0],address:{name:a.name},original:{formatted:a.address.formattedAddress,details:a.address}}})};var z=function(a){return this.Base=a,this.layer_name=s.randomId("geocoder-layer-"),this.layer=new ol.layer.Vector({name:this.layer_name,source:new ol.source.Vector}),this.options=a.options,this.options.provider=this.options.provider.toLowerCase(),this.els=this.createControl(),this.container=this.els.container,this.registered_listeners={map_click:!1},this.setListeners(),this.Photon=new t,this.OpenStreet=new u,this.MapQuest=new v,this.Pelias=new w,this.Google=new x,this.Bing=new y,this};z.prototype.createControl=function(){var e=s.createElement(["div",{classname:a+b}],z.html),g={container:e,control:e.querySelector("."+(a+c)),btn_search:e.querySelector("."+(a+d)),input_search:e.querySelector("."+(a+m)),result_container:e.querySelector("."+(a+f))};return g.input_search.placeholder=this.options.placeholder,g},z.prototype.setListeners=function(){var b,c,d=this,e=function(){s.hasClass(d.els.control,a+g)?d.collapse():d.expand()},f=function(a){13==a.keyCode&&(a.preventDefault(),d.query(a.target.value))},h=function(a){var e=a.target.value;e!=c&&(c=e,b&&clearTimeout(b),b=setTimeout(function(){e.length>=d.options.autoCompleteMinLength&&d.query(e)},200))};this.els.input_search.addEventListener("keydown",f,!1),this.els.btn_search.addEventListener("click",e,!1),this.options.autoComplete&&this.els.input_search.addEventListener("input",h,!1)},z.prototype.query=function(b){var c=this,d={},f=this.options,g=this.els.input_search,h=this.getProvider({query:b,provider:f.provider,key:f.key,lang:f.lang,countrycodes:f.countrycodes,limit:f.limit});this.clearResults(),s.addClass(g,a+e),d.url=h.url,d.data=h.params,f.provider===q.BING&&(d.data_type="jsonp",d.callbackName=h.callbackName),s.json(d).when({ready:function(b){f.debug&&console.info(b),s.removeClass(g,a+e);var d;switch(f.provider){case q.OSM:d=b.length>0?c.OpenStreet.handleResponse(b):void 0;break;case q.MAPQUEST:d=b.length>0?c.MapQuest.handleResponse(b):void 0;break;case q.PELIAS:d=b.features.length>0?c.Pelias.handleResponse(b.features):void 0;break;case q.PHOTON:d=b.features.length>0?c.Photon.handleResponse(b.features):void 0;break;case q.GOOGLE:d=b.results.length>0?c.Google.handleResponse(b.results):void 0;break;case q.BING:d=b.resourceSets[0].resources.length>0?c.Bing.handleResponse(b.resourceSets[0].resources):void 0}d&&(c.createList(d),c.listenMapClick())},error:function(){s.removeClass(g,a+e);var b=s.createElement("li","<h5>Error! No internet connection?</h5>");c.els.result_container.appendChild(b)}})},z.prototype.createList=function(a){var b=this,c=this.els.result_container;a.forEach(function(a){var d=b.addressTemplate(a.address),e='<a href="#">'+d+"</a>",f=s.createElement("li",e);f.addEventListener("click",function(c){c.preventDefault(),b.chosen(a,d,a.address,a.original)},!1),c.appendChild(f)})},z.prototype.chosen=function(a,b,c,d){var e=this.Base.getMap(),f=ol.proj.transform([parseFloat(a.lon),parseFloat(a.lat)],"EPSG:4326",e.getView().getProjection()),g={formatted:b,details:c,original:d};this.options.keepOpen===!1&&this.clearResults(!0),this.options.preventDefault===!0?this.Base.dispatchEvent({type:o.ADDRESSCHOSEN,address:g,coordinate:f}):s.flyTo(e,f)},z.prototype.createFeature=function(a){var b=new ol.Feature(new ol.geom.Point(a));this.addLayer(),b.setStyle(this.options.featureStyle),b.setId(s.randomId("geocoder-ft-")),this.getSource().addFeature(b)},z.prototype.addressTemplate=function(b){var c=[];return b.name&&c.push('<span class="'+a+j+'">{name}</span>'),(b.road||b.building||b.house_number)&&c.push('<span class="'+a+j+'">{building} {road} {house_number}</span>'),(b.city||b.town||b.village)&&c.push('<span class="'+a+i+'">{postcode} {city} {town} {village}</span>'),(b.state||b.country)&&c.push('<span class="'+a+h+'">{state} {country}</span>'),s.template(c.join("<br>"),b)},z.prototype.getProvider=function(a){var b;switch(a.provider){case q.OSM:b=this.OpenStreet.getParameters(a);break;case q.MAPQUEST:b=this.MapQuest.getParameters(a);break;case q.PHOTON:b=this.Photon.getParameters(a);break;case q.GOOGLE:b=this.Google.getParameters(a);break;case q.PELIAS:b=this.Pelias.getParameters(a);break;case q.BING:b=this.Bing.getParameters(a)}return b},z.prototype.expand=function(){var b=this;s.removeClass(this.els.input_search,a+e),s.addClass(this.els.control,a+g),window.setTimeout(function(){b.els.input_search.focus()},100),this.listenMapClick()},z.prototype.collapse=function(){this.els.input_search.value="",this.els.input_search.blur(),s.removeClass(this.els.control,a+g),this.clearResults()},z.prototype.listenMapClick=function(){if(!this.registered_listeners.map_click){var a=this,b=this.Base.getMap().getTargetElement();this.registered_listeners.map_click=!0,b.addEventListener("click",{handleEvent:function(c){a.clearResults(!0),b.removeEventListener(c.type,this,!1),a.registered_listeners.map_click=!1}},!1)}},z.prototype.clearResults=function(a){a?this.collapse():s.removeAllChildren(this.els.result_container)},z.prototype.getSource=function(){return this.layer.getSource()},z.prototype.addLayer=function(){var a=this,b=!1,c=this.Base.getMap();c.getLayers().forEach(function(c){c===a.layer&&(b=!0)}),b||c.addLayer(this.layer)},z.html=['<div class="',a+c," ",k,'">',"<button",' type="button"',' class="'+a+d+'">',"</button>",'<form id="'+l+'" action="javascript:void(0);">',"<input",' type="text"',' id="'+n+'"',' class="'+a+m+'"',' placeholder="Search ...">',"</form>","</div>",'<ul class="',a+f,'"></ul>'].join("");var A=function(a){function b(c,d){void 0===c&&(c="nominatim"),void 0===d&&(d={}),s.assert("string"==typeof c,"@param `control_type` should be string type!"),s.assert("object"==typeof d,"@param `opt_options` should be object type!"),this.options=s.mergeOptions(r,d),b.Nominatim=new z(this),a.call(this,{element:b.Nominatim.container})}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.getLayer=function(){return b.Nominatim.layer},b.prototype.getSource=function(){return this.getLayer().getSource()},b}(ol.control.Control);return A});
